#
# Copyright (c) 2005 Jose F. Nieves <nieves@ltp.uprrp.edu>
#
# See LICENSE
#
# $Id$
#
@include@ @q@../../../Makefile.inc@q@

TCLTARGET =	nbspgismap nbspgisbundlemap nbspgisradmap nbspgissatmap
TCLSOURCES =	nbspgismap.tcl nbspgisbundlemap.tcl \
		nbspgisradmap.tcl nbspgissatmap.tcl
SHTARGET =	nbspgoesrmap
SHSOURCES =	nbspgoesrmap.sh


TMPLSOURCES =	gis-colors.def.in \
		gis-colors-rgb.def gis-colors-bref.def gis-colors-rvel.def \
		gis-colors-nxp.def gis-colors-srvel.def

TMPLOBJECTS =	gis-colors.def

TMPLFILES =	${TMPLOBJECTS} \
		map_sat.tmpl \
		map_rad_bref.tmpl \
		map_rad_bref_1.tmpl map_rad_bref_3.tmpl map_rad_bref_5.tmpl \
		map_rad_rvel.tmpl map_rad_rvel_1.tmpl \
		map_rad_nxp.tmpl map_rad_srvel.tmpl

LEGENDFILES =	legends/gis_rad_legend_bref.html \
		legends/gis_rad_legend_rvel.html \
		legends/gis_rad_legend_nxp.html \
		legends/gis_rad_legend_srvel.html

TMPLTARGET =    gismap-templates.tgz
TMPLPDIR =      gis
TMPLDIR =	${TMPLPDIR}/map
LEGENDDIR =	${TMPLPDIR}/legends

SHAREFILES =	geodata-share.tgz mapfonts-share.tgz
LIBFILES =	gis.tcl radstations/radstations.tcl

SAMPLES =	gismap-bundle.conf-sample
DEFAULTS =	gismap-bundle.conf-defaults

TARGET =	${TCLTARGET} ${SHTARGET} ${TMPLTARGET} ${SAMPLES}

TCLSH =		@TCLSH@
INSTALL =	@INSTALL@

all: ${TARGET}

nbspgismap: nbspgismap.tcl
	sed -e /%TCLSH%/s##${TCLSH}# nbspgismap.tcl > nbspgismap

nbspgisbundlemap: nbspgisbundlemap.tcl
	sed -e /%TCLSH%/s##${TCLSH}# nbspgisbundlemap.tcl > nbspgisbundlemap

nbspgisradmap: nbspgisradmap.tcl
	sed -e /%TCLSH%/s##${TCLSH}# nbspgisradmap.tcl > nbspgisradmap

nbspgissatmap: nbspgissatmap.tcl
	sed -e /%TCLSH%/s##${TCLSH}# nbspgissatmap.tcl > nbspgissatmap

nbspgoesrmap: nbspgoesrmap.sh
	sed -e /%SHELL%/s##${SHELL}# \
	-e /%MYSHAREDIR%/s##${MYSHAREDIR}# nbspgoesrmap.sh > nbspgoesrmap

gismap-bundle.conf-sample: gismap-bundle.conf
	cp gismap-bundle.conf gismap-bundle.conf-sample

gis-colors.def: gis-colors.def.in \
	gis-colors-rgb.def gis-colors-bref.def gis-colors-rvel.def \
	gis-colors-nxp.def
	sed -e '/@gis-colors-rgb@/r gis-colors-rgb.def' \
	-e '/@gis-colors-rgb@/d' \
	-e '/@gis-colors-bref@/r gis-colors-bref.def' \
	-e '/@gis-colors-bref@/d' \
	-e '/@gis-colors-rvel@/r gis-colors-rvel.def' \
	-e '/@gis-colors-rvel@/d' \
	-e '/@gis-colors-nxp@/r gis-colors-nxp.def' \
	-e '/@gis-colors-nxp@/d' \
	-e '/@gis-colors-srvel@/r gis-colors-srvel.def' \
	-e '/@gis-colors-srvel@/d' gis-colors.def.in > gis-colors.def 

#geodata-share.tgz:
#	tar -c @EXCLUDE@'*.svn*' -z -f geodata-share.tgz geodata

${TMPLTARGET}: ${TMPLFILES} ${LEGENDFILES}
	rm -rf ${TMPLPDIR}
	mkdir -p ${TMPLDIR} ${LEGENDDIR}
	cp ${TMPLFILES} ${TMPLDIR}
	cp ${LEGENDFILES} ${LEGENDDIR}
	tar -czf ${TMPLTARGET} ${TMPLPDIR}

install: ${TARGET}
	${INSTALL} -m 755 ${TCLTARGET} ${BINDIR}
	${INSTALL} -m 755 ${SHTARGET} ${BINDIR}
	${INSTALL} -m 644 ${SAMPLES} ${TMPLTARGET} ${DEFAULTS} ${MYCONFDIR}
	${INSTALL} -m 644 ${SHAREFILES} ${MYSHAREDIR}
	${INSTALL} -m 644 ${LIBFILES} ${MYLIBEXECDIR}

clean:
	rm -f *~ Makefile ${TARGET} ${TMPLOBJECTS}
	rm -rf ${TMPLPDIR}
