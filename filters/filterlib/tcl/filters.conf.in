#
# $Id$
#
# This file contains common definitions for all the filters.
# This file is required; the filters will not run without it.
# The default location of this file is the directory "/usr/local/etc/nbsp".
#
# In addition, each filter has an individual conf file and an rc file. 
# The individual conf file is optional, but the rc file is required.
#
# Fine tuning -
#
# Most of the settings below are directory (and a few other parameter)
# definitions that hardly require modification except in special installations.
# The "Fine-Tuning" section (at the end of this file) does contain some
# parameters that could be useful set in some cases to improve the
# performance of the filters.

set common(filtersconf)   "filters.conf";
#
# Common directories
#
set common(confdir)	  "/usr/local/etc/nbsp"
set common(localconfdirs) [list [file join $common(confdir) "defaults"] \
				[file join $common(confdir) "site"]];
##
# regexp {^[^\.]+} [info hostname] _hostname;
# lappend common(localconfdirs) \
#         [file join $common(confdir) "site" ${_hostname}];
##
set common(rcdir)	[file join $common(confdir) "rc.d"];
set common(libdir)	"/usr/local/libexec/nbsp";
set common(sharedir)	"/usr/local/share/nbsp";
set common(locallibdir)	[file join $common(libdir) "site"];
set common(datadir)	"/var/noaaport/data";
set common(archivedatadir) "/var/noaaport/archive/data";
set common(archiveinvdir) "/var/noaaport/archive/inv";
set common(nbspdir)	"/var/noaaport/nbsp";
set common(tmpdir)	[file join $common(nbspdir) "tmp"];
set common(datainvdir)  [file join $common(datadir) "inv"];
set common(datainvformat)  "%Y%m%d%H";  # format for hourly subdirs

# Common functions used by some filters, and the global variables
# used by them (ccbsize and wmoawips_size come from src/sbn.h).
# (wmoawips_size is used by the dafilter and rstfilter when dealing
# with radar files. The radheadersize is used by the filterlib (dafilter)
# to extract the radar info from the nids data file.
# The total ccb + wmo + ( BBB) + awips header is
# 24 + 18 (+ 4) + 6 + 6 = 54 (58), including \r\r\n twice).
#
set common(filterslib)		[file join $common(libdir) "filters.lib"];
set common(ccbsaved)		1;
set common(ccbsize)		24;
set common(wmoheadersize)	18;     # excluding the possible ( BBB)
set common(wmoawips_size)	30;	# excluding the possible ( BBB)
set common(totalheadersize)  [expr $common(ccbsize) + $common(wmoawips_size)];
# These two are not used; they are here for documentation purposes
set common(wmobbbheadersize)	22;     # including the possible ( BBB)
set common(wmobbbawips_size)	34;     # including the possible ( BBB)
#
set filterslib(ccbsaved)	$common(ccbsaved);
set filterslib(ccbsize)		$common(ccbsize);
set filterslib(wmoawips_size)	$common(wmoawips_size);
set filterslib(totalheadersize) $common(totalheadersize);
set filterslib(bodypartsize)	512;
set filterslib(gmpk_header_fmt) "\001\r\r\n%03d \r\r\n"; 
set filterslib(gmpk_trailer_str) "\r\r\n\003";
set filterslib(gmpk_header_size) 11;	# gpfilter/c/const.h
set filterslib(wmoawipsgmpk_header_size) [expr $filterslib(wmoawips_size) + \
	$filterslib(gmpk_header_size)];    # used in nbspradmap
#
set filterslib(ignorebody)	{_(sdus|tig)|\+(grib|bufr)};
#
# Which nids for nbspradinfo must be piped through nbspunz first
# (It is matched against awips1). Included are:
#  n0r n1r n2r n3r n0z n0v n1v nce net nvw n0s n1s n2s n3s nvl n1p ntp tr[0-2] 
#
# The following have an uncompressed nids header.
#
# tv0-tv2, tzl, nmd, dhr, dsp (+ the dual pol below)
# n0q naq n1q nbq n2q n3q n0u nau n1u nbu n2u n3u dvl eet (dual pol)
#
set filterslib(doradinfounz)	{tr[0-2]|n[0-3][prsvz]|n(cr|vl|et|tp|vw)};

# Global variables of the filtererr library.
# By default the filters report errors using syslog.
# Otherwise, if usesyslog is set to 0 they will report to stderr or,
# if it is set to 2, to a logfile in the directory defined below.
# (That directory is also used by the gempak decoders).
# If errorInfo is set, then the filters print
# debuging information using the tcl errorInfo variable.
#
set common(debug)		0;
set filterserrlib(usesyslog)	1;
set filterserrlib(logdir)	"/var/log/noaaport";
set filterserrlib(errorInfo)	$common(debug);

# The definitions used by the gribid library to extract information
# from the grib files (used by the dafilter, gpfilter and ldmfilter).
#
set common(filtersgribiddef) [file join $common(confdir) "filters-gribid.def"];

# Location of the external programs used by the filters.
#
set env(PATH)	 "%PATH%";
append env(PATH) ":/usr/local/bin:/usr/local/sbin";
append env(PATH) ":$common(libdir):$common(locallibdir)";
#
lappend auto_path $common(libdir) $common(locallibdir);
#
set common(nbspbindir)	"/usr/local/bin";
set common(netpbmbindir) "%NETPBMBINDIR%";
set common(innbindir) "%INNBINDIR%";

# The paths to the external programs used by the filters are
# collected in the array "filtersprogs".
#
set filtersprogs(pngtopnm)	$common(netpbmbindir)/pngtopnm;
set filtersprogs(giftopnm)	$common(netpbmbindir)/giftopnm;
set filtersprogs(pnmtojpeg)	$common(netpbmbindir)/pnmtojpeg;
set filtersprogs(ppmtogif)	$common(netpbmbindir)/ppmtogif;
set filtersprogs(pnmtopng)	$common(netpbmbindir)/pnmtopng;
set filtersprogs(innsm)		$common(innbindir)/sm;
#
set filtersprogs(nbspfile)	$common(nbspbindir)/nbspfile;
set filtersprogs(nbspunz)	$common(nbspbindir)/nbspunz;
set filtersprogs(nbsppipe)	$common(nbspbindir)/nbsppipe;
set filtersprogs(nbspgrib)	$common(nbspbindir)/nbspgrib;
set filtersprogs(nbspgrib2)	$common(nbspbindir)/nbspgrib2;
set filtersprogs(nbspsat)	$common(nbspbindir)/nbspsat;
set filtersprogs(nbspsatinfo)	$common(nbspbindir)/nbspsatinfo;
set filtersprogs(nbspsatmap)	$common(nbspbindir)/nbspsatmap;
set filtersprogs(nbspradmap)	$common(nbspbindir)/nbspradmap;
set filtersprogs(nbspnntpsend)	$common(nbspbindir)/nbspnntpsend;
set filtersprogs(nbsppngcvt)	$common(nbspbindir)/nbsppngcvt;
set filtersprogs(nbspdmtr)	$common(nbspbindir)/nbspdmtr;
set filtersprogs(nbspmtrd)	$common(nbspbindir)/nbspmtrd;
set filtersprogs(nbspmtrcsv)	$common(nbspbindir)/nbspmtrcsv;
set filtersprogs(nbspmtr)	$common(nbspbindir)/nbspmtr;
set filtersprogs(nbspmtrplot)	$common(nbspbindir)/nbspmtrplot;
set filtersprogs(nbspstatplot)	$common(nbspbindir)/nbspstatplot;
set filtersprogs(nbspstatplot1)	$common(nbspbindir)/nbspstatplot1;
set filtersprogs(nbspstatplotdat) $common(nbspbindir)/nbspstatplotdat;
set filtersprogs(nbspudpsend)	$common(nbspbindir)/nbspudpsend;

# Gempak installation directory and bin directory of the decoders and tools.
# The settings below correspond to a Gempak installation via the gpak package.
# For a Gempak installation under /home the settings would be
#
## set gempak(homedir)	"/home/gempak/NAWIPS";
## set gempak(bindir)	"/home/gempak/NAWIPS/os/%GPOSNAME%/bin";
#
# gempak(libdir) is not used but it is here for completeness.
#
set gempak(homedir)	"/usr/local/lib/gempak/NAWIPS";
set gempak(bindir)	"/usr/local/lib/gempak/NAWIPS/os/%GPOSNAME%/bin";
set gempak(libdir)	"/usr/local/lib/gempak/NAWIPS/os/%GPOSNAME%/lib";
#
# nbspradmap and nbspsatmap (of rstfilter) call gempak programs that must
# run with the gempak env variables.
set gempak(envfile)	[file join $common(confdir) "gempak.env"];

#
# Fine-Tuning
#

# The configuration file of the spool cache (cspool).
#
set common(cspoolbdbconf) [file join $common(confdir) "cspoolbdb.conf"];

# If this variable to 1 the filters (using the functions in filters.lib) will
# try to fire up as many processes in parallel as they can when they are
# processing data files. It is generally a good idea to set it in
# multiprocessor machines, but not recommended in uniprocessor ones.
#
set filterslib(background_processing) 0;

#
# Read the local overrides
#
if {[info exists source_filters_conf_defined]} {
    return;
}
set source_filters_conf_defined 1;

set _confname $common(filtersconf);
foreach _d $common(localconfdirs) {
    set _localconfname ${_d}/${_confname}
    if {[file exists ${_localconfname}] == 1} {
        source ${_localconfname};
    }
}
unset _d;
unset _confname;
unset _localconfname;
